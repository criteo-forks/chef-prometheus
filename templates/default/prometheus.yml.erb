# Global default settings.
global:
  scrape_interval:     "15s"
  evaluation_interval: "15s"

rule_files:
- "rules/*.rules"

scrape_configs:
<% for job in @jobs||[] %>
- job_name: "<%= job.name %>"
  <% if job.scrape_interval %>
  scrape_interval: "<%= job.scrape_interval %>"
  <% end %>
  <% if job.scrape_timeout %>
  scrape_timeout: "<%= job.scrape_timeout %>"
  <% end %>
  metrics_path: "<%= job.metrics_path %>"
  <% if job.consul_sd_server and job.consul_sd_services %>
  consul_sd_configs:
    - server: <%= job.consul_sd_server %>
    <% if job.consul_sd_datacenter %>
      datacenter: <%= job.consul_sd_datacenter %>

    <% end %>
      services: <%= job.consul_sd_services %>
  <% end %>
  <% if job.target %>
  target_groups:
    - targets: <%= [job.target].flatten().map{ |t| t.gsub(Regexp.new('http://(.*)/metrics'), '\1') } %>
  <% end %>
<% end %>
